---
title: "Querying Cellosaurus"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Querying Cellosaurus}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction
Cellosaurus is a comprehensive knowledge resource dedicated to cell lines,
providing a wealth of information about various types of cells used in
biomedical research. It serves as a centralized repository that offers
detailed data on cell lines, including their origins, characteristics,
authentication methods, references, and more. Please view the Cellosaurus
website at https://web.expasy.org/cellosaurus/ for more information and
a detailed description can be found at https://www.cellosaurus.org/description.html.

The `AnnotationGx` package provides a wrapper around the Cellosaurus API to 
map cell line identifiers to the Cellosaurus database fields. 

### Setup

```{r setup}
library(AnnotationGx)
library(data.table)
```


### Mapping from Cell Line name to Accession id
The main function that is provided by the package is `mapCell2Accession`. This function
takes in a vector of cell line identifiers and returns a `data.table`. 

```
Usage and default values:
     mapCell2Accession(
       ids,
       numResults = 1000,
       from = "id",
       to = c("id", "ac"),
       prioritizeParent = FALSE,
       orderby = "ac",
       query_only = FALSE,
       raw = FALSE,
       BPPARAM = BiocParallel::SerialParam(),
       ...
     )
```

Let's see how we can use this function to map the "HeLa" and "A549" cell line names
to the Cellosaurus database. 
By default, the function will try to map using the common identifier (`from ="id"`) name and 
will return the standard identifier `id` and the Cellosaurus accession ID `ac`. The 
function also returns two additional columns `query` and `query:<from>` which
can be used to identify the original query and the original identifier type if needed. 
``` {r map heLa each}
mapCell2Accession("hela", numResults = 1)
```

### Misspelled or non-standard cell line names

Sometimes the cell line name might be misspelled or might not be the standard name. 
This is the case if we query for "A549" in the same way. 
``` {r map one name each}
# our query:
mapCell2Accession("A549", from = "id", numResults = 1)

# if we use the actual standard name:
mapCell2Accession("A-549", from = "id", numResults = 1)
```

As seen above, the standard name for the A549 cell line is "A-549" and the accession id is "CVCL_0023".
If we don't know which cell line name is the standard name, we can use the `numResults` parameter to get more results. 


``` {r moreresults}
# trying to get the standard name with more results
mapCell2Accession("A549", from = "id", numResults = 10)
```

The main identifier for the A549 cell line is "A-549" with accesion id of "CVCL_0023" 
which does not appear in even the first 10 results (it would be the 40th result 
if we further adjusted the `numResults` parameter) and while we could manually adjust every query 
to match the standard name, this is not feasible for hundreds of cell lines. 

There are a few ways to deal with this issue. 
The first method is based on the reasoning that many of the cell lines are derived from a parent cell line.
To deal with this issue, we can use the `prioritizeParent` argument. 
This argument will use the parent cell line of each returned result and prioritize the
results based on the accession id of the parent cell line. 

``` {r map A549 each}
mapCell2Accession("A549", from = "id", numResults = 1, prioritizeParent = TRUE)
```

Another example using the BT474 cell line. 

``` {r map BT474 each}
# our query:
mapCell2Accession("BT474", numResults = 1, prioritizeParent = FALSE)

# if we use the actual standard name:
mapCell2Accession("BT-474", numResults = 1, prioritizeParent = FALSE)

# if we use our query and prioritize the parent cell line:
mapCell2Accession("BT474", numResults = 1, prioritizeParent = TRUE)
```




